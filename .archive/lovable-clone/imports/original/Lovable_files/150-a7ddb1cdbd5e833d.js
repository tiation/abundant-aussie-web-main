try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f4de1eba-f6cf-4c7e-946b-f889898b1c1a",e._sentryDebugIdIdentifier="sentry-dbid-f4de1eba-f6cf-4c7e-946b-f889898b1c1a")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[150],{85472:function(e,t,r){r.d(t,{H:function(){return n}});class n extends Error{constructor(e,t,r,n,s){super(t),this.type=e,this.details=r,this.status=n,this.traceId=s}}},35034:function(e,t,r){r.d(t,{O:function(){return n}});class n extends Error{constructor(e,t,r,n,s){super(e),this.status=t,this.statusText=r,this.response=n,this.traceId=s}}},25057:function(e,t,r){r.d(t,{t:function(){return n}});let n=()=>"https://lovable-api.com"},64040:function(e,t,r){r.d(t,{B8:function(){return d},Eo:function(){return g},SC:function(){return l}});var n=r(14438),s=r(91115),o=r(21288),a=r(85472),i=r(75502),c=r(65001);let l={network:"network_error",malformed:"malformed_response"},u=s.z.object({type:s.z.string(),message:s.z.string().optional().transform(e=>e||void 0),details:s.z.string().optional().transform(e=>e||void 0)});function d(e){if((0,i.kW)(e)){var t,r,n;let s={url:null===(t=e.response)||void 0===t?void 0:t.url,method:e.httpMethod,status:e.status},i=(null===(n=e.response)||void 0===n?void 0:null===(r=n.headers)||void 0===r?void 0:r.get("X-Trace-Id"))||void 0;if(!e.response)return(0,c.H)("Network error",{error:e,severity:o.i.INFO,context:s}),new a.H(l.network,"Connection Error","Please check your internet connection");let d=e.data,g=u.safeParse(d);if(g.success){let t=new a.H(g.data.type,g.data.message||"",g.data.details,e.status,i);return(0,c.v)({error:t,severity:o.i.INFO,context:s}),t}return(0,c.H)("Bad error from backend",{error:e,severity:o.i.ERROR,context:{...s,error_data:d,response:e.response,zodError:g.error}}),new a.H(l.malformed,e.statusText||"",void 0,e.status,i)}return(0,c.H)("Unhandled error type",{error:e,severity:o.i.ERROR}),new a.H(l.malformed,"")}function g(e){e instanceof a.H?(n.Am.error(e.message||"Something went wrong",{duration:8e3,description:e.details}),e.message||(0,c.H)("User sees vague api error",{error:e,severity:o.i.ERROR})):(n.Am.error("Something went wrong",{description:"Lovable has been notified.",duration:8e3}),(0,c.H)("User sees vague error",{error:e,severity:o.i.ERROR}))}},75502:function(e,t,r){function n(e){return e instanceof Error&&"number"==typeof e.status&&"data"in e&&"string"==typeof e.httpMethod}r.d(t,{B:function(){return o},kW:function(){return n}});class s{setResponseHandler(e){this.responseHandler=e}setErrorHandler(e){this.errorHandler=e}createUrl(e,t){let r=new URL("".concat(this.baseURL).concat(e));return t&&Object.entries(t).forEach(e=>{let[t,n]=e;null!=n&&r.searchParams.append(t,n)}),r.toString()}createRequestOptions(e,t,r){let n={method:e,headers:{"Content-Type":"application/json",...this.defaultHeaders,...(null==t?void 0:t.headers)||{}},credentials:this.withCredentials?"include":"same-origin",signal:null==t?void 0:t.signal};return void 0===r||["GET","HEAD"].includes(e)||(n.body=JSON.stringify(r)),n}async processResponse(e,t){return this.responseHandler?await this.responseHandler(e,t):e}async processError(e,t){throw this.errorHandler&&(e=await this.errorHandler(e,t)),e}async request(e,t,r,n){try{let s=this.createUrl(t,null==r?void 0:r.params),o=this.createRequestOptions(e,r,n),a=await fetch(s,o);if(!a.ok){let t=Error("Request failed with status ".concat(a.status));t.response=a,t.status=a.status,t.statusText=a.statusText,t.httpMethod=e;let r=a.clone();try{t.data=await r.json()}catch(e){t.data=await a.text()}return this.processError(t,a)}if(204===a.status||"0"===a.headers.get("Content-Length"))return this.processResponse({},a);let i=await a.json();return this.processResponse(i,a)}catch(e){return this.processError(e)}}async get(e,t){return this.request("GET",e,t)}async delete(e,t){return this.request("DELETE",e,t)}async head(e,t){return this.request("HEAD",e,t)}async post(e,t,r){return this.request("POST",e,r,t)}async put(e,t,r){return this.request("PUT",e,r,t)}async patch(e,t,r){return this.request("PATCH",e,r,t)}constructor(e,t={},r=!1){this.responseHandler=null,this.errorHandler=null,this.baseURL=e,this.defaultHeaders=t,this.withCredentials=r}}function o(e){return new s(e.baseURL,e.headers,e.withCredentials)}},49131:function(e,t,r){r.d(t,{SJ:function(){return E},aX:function(){return b},Tb:function(){return R}});var n=r(91115),s=r(52285),o=r(80733),a=r(21288);async function*i(e){yield*c(l(e))}async function*c(e){let t=null;for await(let r of e)if(!r.startsWith(":")){if(r.startsWith("event:")){t&&a.logging.error("received_sse_event_without_data",{event_type:t}),t=r.slice(6).trim();continue}if(r.startsWith("data:")){let e=r.slice(5).trimStart();try{yield{type:t,data:JSON.parse(e)}}catch(r){a.logging.error("failed_to_parse_sse_event",{error:r,event_type:t,event_data:e})}t=null}}}async function*l(e){let t=new TextDecoder,r="";for(;;){let{done:n,value:s}=await e.read(),o=(r+=t.decode(s,{stream:!n})).split(/\n+/);for(let e of(r=o.pop()||"",o))yield e;if(n){r&&(yield r);break}}}var u=r(85472),d=r(64040),g=r(75502),h=r(65001),f=r(35034);function p(e,t){return(0,g.B)({baseURL:t,headers:e?{Authorization:"Bearer ".concat(e)}:void 0,withCredentials:!0})}class y{async getApi(){if(!o.g.isInitialized())return await new Promise(e=>setTimeout(e,50)),this.getApi();let e=await o.g.getValidToken();e||(0,h.H)("Tried to get API with no valid ID token",{error:Error("Tried to get API with no valid ID token"),severity:a.i.ERROR});let t=p(e,this.baseURL);return t.setResponseHandler((e,t)=>{if(t.headers.get("Lovable-Cachebuster")){let e=new CustomEvent("lovable-cachebuster");document.dispatchEvent(e)}return e}),t.setErrorHandler((e,t)=>{if(null==t?void 0:t.headers.get("Lovable-Cachebuster")){let e=new CustomEvent("lovable-cachebuster");document.dispatchEvent(e)}if(e&&"object"==typeof e&&"status"in e&&401===e.status){let e=window.location.pathname;s.i.emitAuthError(e)}return Promise.reject((0,d.B8)(e))}),t}async get(e,t){return(await this.getApi()).get(e,t)}async delete(e,t){return(await this.getApi()).delete(e,t)}async post(e,t,r){return(await this.getApi()).post(e,t,r)}async put(e,t,r){return(await this.getApi()).put(e,t,r)}async patch(e,t,r){return(await this.getApi()).patch(e,t,r)}async head(e,t){return(await this.getApi()).head(e,t)}async postWithStreaming(e,t,r,n){let s=await o.g.getValidToken(),c=await fetch("".concat(this.baseURL).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},Accept:"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache"},body:JSON.stringify(t),signal:n}),l=c.headers.get("X-Trace-Id")||void 0;if(!c.ok){let e;try{let t=await c.text(),r=c.headers.get("Content-Type")||"";if(r.includes("application/json"))try{e=JSON.parse(t)}catch(n){a.logging.error("failed_to_parse_json_response",{error:n,responseText:t,contentType:r}),e=t}else a.logging.debug("non_json_error_response",{contentType:r,responseText:t}),e=t}catch(e){a.logging.error("failed_to_parse_response_body",{error:e,status:c.status,contentType:c.headers.get("Content-Type")})}if(429===c.status)throw new f.O("We are currently under heavy load, please try again later.",429,"RATE_LIMIT_EXCEEDED",e,l);throw new f.O("Request failed",c.status,c.statusText,e,l)}let u=c.body.getReader();try{for await(let e of i(u)){if("error"===e.type)throw m(e,l);try{r(e)}catch(e){a.logging.error("unhandled_error_in_message_handler",{error:e})}}}catch(t){if(await u.cancel().catch(()=>{}),t instanceof Error&&"AbortError"===t.name)return;if(t instanceof f.O){if(499===t.status){a.logging.info("message_cancelled",{url:e});return}throw t}throw a.logging.error("unexpected_error_during_sse",{error:t}),t}finally{u.releaseLock()}}async getWithStreaming(e){let{url:t,onMessage:r,params:n,signal:s,reconnectOptions:c}=e,l={initialDelayMs:1e3,maxDelayMs:1e4,backoffFactor:2,retryCount:10,...c},u=0,d=async()=>{try{let e=await o.g.getValidToken(),c="".concat(this.baseURL).concat(t);if(n&&Object.keys(n).length>0){let e=new URLSearchParams(n).toString();c+=(t.includes("?")?"&":"?")+e}let l=await fetch(c,{method:"GET",headers:{...e?{Authorization:"Bearer ".concat(e)}:{},Accept:"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache"},signal:s}),u=l.headers.get("X-Trace-Id")||void 0;if(!l.ok){let e;try{let t=await l.text(),r=l.headers.get("Content-Type")||"";if(r.includes("application/json"))try{e=JSON.parse(t)}catch(n){a.logging.error("failed_to_parse_json_response",{error:n,responseText:t,contentType:r}),e=t}else a.logging.debug("non_json_error_response",{contentType:r,responseText:t}),e=t}catch(e){a.logging.error("failed_to_parse_response_body",{error:e,status:l.status,contentType:l.headers.get("Content-Type")})}if(429===l.status)throw new f.O("We are currently under heavy load, please try again later.",429,"RATE_LIMIT_EXCEEDED",e,u);throw new f.O("Request failed",l.status,l.statusText,e,u)}let d=l.body.getReader();try{for await(let e of i(d)){if("error"===e.type)throw m(e,u);try{r(e)}catch(e){a.logging.error("unhandled_error_in_message_handler",{error:e})}}}catch(e){if(await d.cancel().catch(()=>{}),e instanceof Error&&"AbortError"===e.name)return;if(e instanceof f.O){if(499===e.status){a.logging.info("stream_connection_cancelled",{url:t});return}throw e}throw a.logging.error("unexpected_error_during_sse",{error:e}),e}finally{d.releaseLock()}}catch(n){var e;if(n instanceof Error&&"AbortError"===n.name){a.logging.info("stream_connection_aborted",{url:t});return}if(n instanceof f.O&&"Request cancelled"===n.message){a.logging.info("stream_connection_cancelled",{url:t});return}if(n instanceof f.O&&"RATE_LIMIT_EXCEEDED"===n.statusText)throw n;if(u>=l.retryCount)throw a.logging.error("stream_connection_max_retries_exceeded",{url:t,maxRetries:l.retryCount,error:n}),n;let r=Math.min(l.initialDelayMs*Math.pow(l.backoffFactor,u),l.maxDelayMs);return a.logging.info("stream_connection_retry",{url:t,retryCount:u+1,maxRetries:l.retryCount,delayMs:r,error:n}),await new Promise(e=>setTimeout(e,r)),u++,null==c||null===(e=c.onReconnect)||void 0===e||e.call(c),d()}};return d()}constructor(e){this.baseURL=e}}function m(e,t){var r;let n=_.safeParse(e.data);if(!n.success)return a.logging.error("failed_to_parse_server_sse_error",{parse_error:n.error,event_data:e.data,traceId:t}),new u.H(d.SC.malformed,"Failed to parse server SSE error",void 0,500,t);let s=n.data,o=null!==(r=s.traceId)&&void 0!==r?r:t;return"Request cancelled"===s.message?new f.O("Request cancelled",499,"REQUEST_CANCELLED",s,o):(a.logging.error("server_sse_error",{error:s,traceId:o}),new f.O(s.message,500,s.type,s,o))}let _=n.z.object({type:n.z.string(),message:n.z.string(),details:n.z.string(),traceId:n.z.string().optional()});var v=r(25057);let w=new y((0,v.t)());function E(){return w}function R(){return p(null,(0,v.t)())}function b(e){return p(e,(0,v.t)())}},65001:function(e,t,r){r.d(t,{H:function(){return i},v:function(){return a}});var n=r(22048),s=r(21288);let o={[s.i.ERROR]:"error",[s.i.WARN]:"warn",[s.i.INFO]:"info",[s.i.DEBUG]:"debug",[s.i.TRACE]:"trace",[s.i.LOG]:"log"};function a(e){let{error:t,severity:r,context:a}=e,i={...a,errorType:t.type},c=o[r];s.logging[c]("api_error_".concat(t.type),{error:t,...i}),(r===s.i.ERROR||r===s.i.WARN)&&n.Tb(Error("API Error: ".concat(t.type)),{extra:{...t,...i}})}function i(e,t){let{error:r,severity:a,context:i}=t,c="".concat(e,": ").concat(r instanceof Error?r.message:"Weird error"),l=r instanceof Error?r:Error(c),u=o[a];s.logging[u](c,{...i,error:r}),(a===s.i.ERROR||a===s.i.WARN)&&(l.message=c,n.Tb(l,{level:a===s.i.ERROR?"error":"warning",extra:{...i,weird_error:r instanceof Error?void 0:r}}))}},52285:function(e,t,r){r.d(t,{i:function(){return o}});var n=r(55445);class s extends n.EventEmitter{emitAuthError(e){this.emit("auth:error",{pathname:e})}}let o=new s},80733:function(e,t,r){r.d(t,{g:function(){return g}});var n=r(40864),s=r(71856);class o{get(e){return this.cacheMap[e]?this.cacheMap[e]:e}set(e,t){this.cacheMap={[e]:t}}constructor(){this.cacheMap={}}}let a=new o;async function i(e){var t;let{serverIdToken:r,refreshTokenUrl:o,checkRevoked:i}=e;if(!r)return null;let c=a.get(r),l=(0,n.t)(c),d=null!==(t=null==l?void 0:l.exp)&&void 0!==t?t:0,g=Date.now()/1e3;if(!i&&g+300<d)return c;let h=await u(o);if(!(null==h?void 0:h.idToken))throw new s.AuthError(s.AuthErrorCode.INTERNAL_ERROR,"Refresh token endpoint returned invalid response. This URL should point to endpoint exposed by the middleware and configured using refreshTokenPath option");return a.set(r,h.idToken),h.idToken}async function c(e,t,r){var n;let o=await l(e);return new s.AuthError(s.AuthErrorCode.INTERNAL_ERROR,"next-firebase-auth-edge: Internal request to ".concat(null!==(n=null==r?void 0:r.method)&&void 0!==n?n:"GET"," ").concat(t.toString()," has failed: ").concat(o))}function l(e){let t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():e.text()}async function u(e,t){let r=await fetch(e,{...t,headers:{...null==t?void 0:t.headers,Accept:"application/json","Content-Type":"application/json"}});if(!r.ok)throw await c(r,e,t);return l(r)}class d{setServerIdToken(e){this.serverIdToken=e,this.initialized=!0}isInitialized(){return this.initialized}async getValidToken(){if(!this.serverIdToken)return null;if(this.refreshPromise)return this.refreshPromise;try{this.refreshPromise=i({serverIdToken:this.serverIdToken,refreshTokenUrl:"/api/refresh-token"});let e=await this.refreshPromise;return this.refreshPromise=null,e}catch(e){return this.refreshPromise=null,null}}constructor(){this.serverIdToken=null,this.refreshPromise=null,this.initialized=!1}}let g=new d},54257:function(e,t,r){r.d(t,{q:function(){return n}});let n="production"===(r(25566).env.NEXT_PUBLIC_NODE_ENV||"production")?{apiKey:"AIzaSyBQNjlw9Vp4tP4VVeANzyPJnqbG2wLbYPw",authDomain:"auth.lovable.dev",projectId:"gpt-engineer-390607",storageBucket:"gpt-engineer-390607.appspot.com",messagingSenderId:"288002387414",appId:"1:288002387414:web:231da37c38c486ca814877",measurementId:"G-EFZ8TB5QLN",clientEmail:"firebase-adminsdk-thfj5@gpt-engineer-390607.iam.gserviceaccount.com"}:{apiKey:"AIzaSyC8MAnZTLUBttWHlEIMl0u8gGI0R5oGnXU",authDomain:"gpt-engineer-dev.firebaseapp.com",projectId:"gpt-engineer-dev",storageBucket:"gpt-engineer-dev.appspot.com",messagingSenderId:"435422046193",appId:"1:435422046193:web:36e2c4049799e14110c650",clientEmail:"firebase-adminsdk-tg5bc@gpt-engineer-dev.iam.gserviceaccount.com"}},78099:function(e,t,r){r.d(t,{I8:function(){return d},Fs:function(){return g},db:function(){return u},j2:function(){return f}});var n=r(44752),s=r(46886),o=r(21288),a=r(738),i=r(17292),c=r(5978),l=r(54257);let{db:u,auth:d,database:g}=(()=>{let e=(0,a.ZF)(l.q),t=(0,c.LV)(e,{experimentalForceLongPolling:!0}),r=(0,n.v0)(e),s=(0,i.N8)(e);return{app:e,db:t,auth:r,database:s}})(),h=!1,f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!h&&t&&e){h=!0;let t=await (0,s.Q9)({serverCustomToken:e,refreshTokenUrl:"/api/refresh-token"});if(!t)return h=!1,o.logging.error("No custom token found in initialize()"),{db:u,auth:d};try{await (0,n._p)(d,t)}catch(e){o.logging.error("Unable to sign-in with custom-token in firebase initialization: ".concat(e)),h=!1}}return{db:u,auth:d,database:g}}},21288:function(e,t,r){r.d(t,{G:function(){return g},i:function(){return s},logging:function(){return p}});var n,s,o=r(49360),a=r(59625),i=r(85472),c=r(35034),l=r(25566);(n=s||(s={})).LOG="LOG",n.TRACE="TRACE",n.DEBUG="DEBUG",n.INFO="INFO",n.WARN="WARN",n.ERROR="ERROR";class u{static generateSessionId(){return(0,o.Z)()}setSession(e){this._session={session_id:u.generateSessionId(),previous_session:this._session.session_id,project_id:e}}setUser(e){this._user=e}get session(){return this._session}get user(){return this._user}sessionForLogging(){let{session_id:e,...t}=this._session;return{session_id:e,...Object.fromEntries(Object.entries(t).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return["session_attrs_".concat(t),r]}))}}userForLogging(){return Object.fromEntries(Object.entries(this._user||{}).filter(e=>{let[t,r]=e;return void 0!==r}).map(e=>{let[t,r]=e;return["user_".concat(t),r]}))}getForLogging(){return Object.fromEntries(Object.entries({...this.sessionForLogging(),...this.userForLogging()}).filter(e=>{let[t,r]=e;return void 0!==r}))}constructor(){this._session={session_id:u.generateSessionId()}}}let d=new u,g=(0,a.Ue)(e=>({metadata:d,setMetadata:t=>e({metadata:t})})),h=async(e,t)=>{var r;let n=t[0],s=null!==(r=t[1])&&void 0!==r?r:{},o=(1e9*Math.floor(Date.now()/1e3)).toString(),a=Object.entries({msg:n,...s,...d.getForLogging(),level:e}).map(e=>{let[t,r]=e;return"".concat(t,"=").concat(JSON.stringify(r,function e(t,r){return r instanceof c.O?{error_class:"StreamedFetchError",message:r.message,status:r.status,statusText:r.statusText,response:e("response",r.response),stack:r.stack}:r instanceof i.H?{error_class:"ApiError",type:r.type,message:r.message,details:r.details,status:r.status,stack:r.stack}:r instanceof Error?{error_class:r.constructor.name,message:r.message,stack:r.stack}:r}))}).join(" "),u={streams:[{stream:{service_name:"gptengineer-app",name:"gptengineer-app",version:l.env.NEXT_PUBLIC_VERSION||"1.0.0",environment:"production",commit_sha:"$COMMIT_REF",level:e},values:[[o,a]]}]},g="https://us-central1-gpt-engineer-390607.cloudfunctions.net/pushLogsToGrafana";if(g)try{await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})}catch(e){}},f=(e,t)=>{h(e,t)},p={info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("INFO",t)},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("DEBUG",t)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("TRACE",t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("WARN",t)},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("ERROR",t)},log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f("LOG",t)}}}}]);